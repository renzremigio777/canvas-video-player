<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIDEO CANVAS</title>

</head>
<style>
    body {
        margin: 0;
        /* background-color: black; */
    }
    
    canvas {
        width: 100%;
        height: 100vh;
        position: fixed;
    }
</style>

<body>

    <canvas id="strmplyr"></canvas>

    <!-- <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.0/hls.js" integrity="sha512-6i9FkwBcp+mVer4oKdPqx4iWX43cjzRP8Q5UZ44EmxctP8Q5i9uiIIeVkNI5FZviXu9wySIBt+CEnLF3pVWkww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        var muted = false;
        var canvas = document.getElementById("strmplyr");
        var ctx = canvas.getContext("2d");
        var videoContainer;
        var video = document.createElement("video"); // create a video element

        var mediaSource = "https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8"

        if (Hls.isSupported()) {
            alert('HLS Supported')
            var hls = new Hls();
            hls.loadSource(mediaSource);
            hls.attachMedia(video);
            videoContainer = {
                video: video,
                ready: false
            }

            video.onerror = function(e) {
                document.body.removeChild(canvas);
                document.body.innerHTML += "<h2>There is a problem loading the video</h2><br>";
                document.body.innerHTML += "Users of IE9+ , the browser does not support WebM videos used by this demo";
                document.body.innerHTML += "<br><a href='https://tools.google.com/dlpage/webmmf/'> Download IE9+ WebM support</a> from tools.google.com<br> this includes Edge and Windows 10";

            }
            video.oncanplay = readyToPlayVideo;
            video.play();
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            alert('HLS Unsupported')
            canvas.remove()
            document.body.appendChild(video)

            video.src = mediaSource;
            // video.addEventListener('loadedmetadata', function() {
            //     videoContainer = {
            //         video: video,
            //         ready: false
            //     }

            //     video.onerror = function(e) {
            //             alert("error occured")
            //     }
            //     video.oncanplay = readyToPlayVideo;
            //     video.play();

            // });
            videoContainer = {
                video: video,
                ready: false
            }

            video.onerror = function(e) {
                alert("error occured")
            }
            video.oncanplay = readyToPlayVideo;
            video.play();
        } else {
            alert("None")
        }





        function readyToPlayVideo(event) {
            videoContainer.scale = 1;
            videoContainer.ready = true;
            requestAnimationFrame(updateCanvas);
        }

        function updateCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (videoContainer !== undefined && videoContainer.ready) {

                video.muted = muted;
                var scale = videoContainer.scale;
                var vidH = window.innerHeight;
                var vidW = window.innerWidth;
                var top = canvas.height / 2 - (vidH / 2) * scale;
                var left = canvas.width / 2 - (vidW / 2) * scale;

                ctx.drawImage(videoContainer.video, left, top, vidW * scale, vidH * scale);
                if (videoContainer.video.paused) {
                    drawPlayIcon();
                }
            }


            requestAnimationFrame(updateCanvas);
        }

        function drawPlayIcon() {

            ctx.fillStyle = "black";
            ctx.globalAlpha = 0.5;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "#DDD";
            ctx.globalAlpha = 0.75;
            ctx.beginPath();
            var size = (canvas.height / 2) * 0.1;
            ctx.moveTo(canvas.width / 2 + size / 2, canvas.height / 2);
            ctx.lineTo(canvas.width / 2 - size / 2, canvas.height / 2 + size);
            ctx.lineTo(canvas.width / 2 - size / 2, canvas.height / 2 - size);
            ctx.closePath();
            ctx.fill();
            ctx.globalAlpha = 1;
        }

        function playPauseClick() {
            if (videoContainer !== undefined && videoContainer.ready) {
                if (videoContainer.video.paused) {
                    videoContainer.video.play();
                } else {
                    videoContainer.video.pause();
                }
            }
        }

        canvas.addEventListener("click", playPauseClick);
    </script>

</body>

</html>