<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIDEO CANVAS 5.26.0 JSON</title>

</head>
<style>
    body {
        margin: 0;
        /* background-color: black; */
    }
    
    canvas {
        width: 100%;
        height: 100vh;
        position: fixed;
        border: 1px solid #000;
    }
</style>
<canvas id="my-canvas"></canvas>

<body>


    <!-- <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.0/hls.js" integrity="sha512-6i9FkwBcp+mVer4oKdPqx4iWX43cjzRP8Q5UZ44EmxctP8Q5i9uiIIeVkNI5FZviXu9wySIBt+CEnLF3pVWkww==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="canvas-video.js"></script> -->
    <script type="text/javascript">
        var canvas = document.getElementById('my-canvas'),
            ctx = canvas.getContext('2d'),
            videoSrc = "https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8",
            videoContainer,
            video = document.createElement("video"), // create a video element
            muted = false

        ctx.fillStyle = 'red';
        ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
        // if (video.canPlayType('application/vnd.apple.mpegurl')) {
        //     alert('HLS Unsupported')
        //         // canvas.remove()
        //         // video.controls = true
        //         // document.body.appendChild(video)

        //     // video.src = videoSrc;
        //     try {

        //         var mediaSource = new MediaSource();
        //         video.src = URL.createObjectURL(mediaSource);

        //         mediaSource.addEventListener('sourceopen', function() {
        //             alert('sourceopen')
        //             var sourceBuffer = mediaSource.addSourceBuffer('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');

        //             fetch(videoSrc)
        //                 .then(function(response) {
        //                     let div = document.createElement('div')
        //                     div.innerHTML = 'Response:' + JSON.stringify(response.text())
        //                     document.body.appendChild(div)

        //                     return response.text();
        //                 })
        //                 .then(function(data) {
        //                     let div = document.createElement('div')
        //                     div.innerHTML = 'Data:' + JSON.stringify(data)
        //                     document.body.appendChild(div)

        //                     sourceBuffer.appendBuffer(data);
        //                 });
        //         });




        //         videoContainer = {
        //             video: video,
        //             ready: false
        //         }

        //         video.onerror = function(e) {
        //             alert("error occured")
        //             let div = document.createElement('div')
        //             div.innerHTML = 'Error:' + e
        //             document.body.appendChild(div)
        //         }
        //         video.oncanplay = readyToPlayVideo;
        //     } catch (e) {
        //         alert(JSON.stringify(e))
        //     }
        // } else
        if (Hls.isSupported()) {
            alert('HLS Supported')
            var hls = new Hls();
            hls.loadSource(videoSrc);
            hls.attachMedia(video);
            videoContainer = {
                video: video,
                ready: false
            }

            video.onerror = function(e) {
                document.body.removeChild(canvas);
                document.body.innerHTML += "<h2>There is a problem loading the video</h2><br>";
                document.body.innerHTML += "Users of IE9+ , the browser does not support WebM videos used by this demo";
                document.body.innerHTML += "<br><a href='https://tools.google.com/dlpage/webmmf/'> Download IE9+ WebM support</a> from tools.google.com<br> this includes Edge and Windows 10";

            }
            video.oncanplay = readyToPlayVideo;
            // video.play();
        }


        // function renderCanvas() {
        //     console.log('re-rendering')
        //     canvas.width = window.innerWidth;
        //     canvas.height = window.innerHeight;
        //     ctx.fillStyle = 'red';
        //     ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
        // }

        function readyToPlayVideo(event) {
            alert('ReadyToPlay')
            videoContainer.scale = 1;
            videoContainer.ready = true;
            requestAnimationFrame(updateCanvas);
        }

        function updateCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (videoContainer !== undefined && videoContainer.ready) {

                video.muted = muted;
                var scale = videoContainer.scale;
                var vidH = window.innerHeight;
                var vidW = window.innerWidth;
                var top = canvas.height / 2 - (vidH / 2) * scale;
                var left = canvas.width / 2 - (vidW / 2) * scale;

                ctx.drawImage(videoContainer.video, left, top, vidW * scale, vidH * scale);
                drawPlayIcon();

                if (videoContainer.video.paused) {
                    // drawPlayIcon();
                }
            }


            requestAnimationFrame(updateCanvas);
        }

        function drawPlayIcon() {

            ctx.fillStyle = "black";
            ctx.globalAlpha = 0.5;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "yellow";
            ctx.globalAlpha = 0.75;
            ctx.beginPath();
            var size = (canvas.height / 2) * 0.1;
            ctx.moveTo(canvas.width / 2 + size / 2, canvas.height / 2);
            ctx.lineTo(canvas.width / 2 - size / 2, canvas.height / 2 + size);
            ctx.lineTo(canvas.width / 2 - size / 2, canvas.height / 2 - size);
            ctx.closePath();
            ctx.fill();
            ctx.globalAlpha = 1;
        }

        function playPauseClick() {
            if (videoContainer !== undefined && videoContainer.ready) {
                if (videoContainer.video.paused) {
                    videoContainer.video.play();
                } else {
                    videoContainer.video.pause();
                }
            }
        }

        canvas.addEventListener("click", playPauseClick);
    </script>

</body>

</html>